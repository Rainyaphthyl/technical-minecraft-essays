# [1.12.2] 末影人西瓜农场 (15.0k/h)

**摘要：**

**关键词：**「」

# **引言**

## **意义**

在1.8~1.13.2的游戏版本中，获取绿宝石的最主要且最可靠的途径是与农民职业的村民进行交易，用于交易的物品分别为小麦、土豆、萝卜、西瓜块、南瓜。在此用途中，虽然这五种物品的效益和成本有优劣之分，但交易的总体原则是「玩家出售的物品种类越多，则交易过程越轻松、稳定」。因此，每一种物品的自动化批量生产都是很有必要的。

除西瓜块以外，另外四种物品可以利用村民或活塞的机制，设计简单装置，实现自动化等级为4的全自动生产。对于西瓜块，如果采用与活塞南瓜农场相同的装置，则需要将直接产出的西瓜片合成为西瓜块，自动化等级仅为1。如果采用玩家精准采集的方式，最高只能实现自动化等级为3的半自动生产，仍然无法实现全自动。

然而，1.9版本更新时添加了「末影人死亡时掉落手持的方块」的特性。利用此特性，让末影人自然生成后拾起西瓜块并掉落，即可实现全自动生产，其自动化等级与另外四种物品相同。至此，五种用于获取绿宝石的交易原材料均可实现全自动批量生产。

## **背景与条件**

末影人西瓜农场设计方案通常有末影螨式和机械式。其中末影螨式是主流方案，但本设计采用机械式方案。

对于任意设计方案，末影人西瓜农场一般可以抽象地分解为两个组件：刷怪塔和瓜田。在估计和分析末影人西瓜农场的效率时，需要综合考虑刷怪塔和瓜田的相关数学模型。由于1.16版本更新更改了末影人占用生物容量的机制，刷怪塔模型发生了较大变化，因此本文不考虑。

本设计成果适用于1.12.2。在不加特殊说明的情况下，下文的所有讨论也默认仅考虑1.12.2，不保证在其他任何版本的适用性。

# 如何达到15k

## 效率预测思路

末影人西瓜农场（以下简称「小黑瓜机」或「瓜机」）是刷怪塔与作物农场的结合，我们很容易想到瓜机效率的计算方法：
$$产瓜效率 = 刷怪效率 \times 搬瓜率$$
- 刷怪效率：单位时间内末影人生成的数量（单位：末影人/h）
- 搬瓜率：给定任意一只末影人，在其完整生命周期内搬走西瓜的概率（取值范围是$[0, 1]$，常用百分数表示）
- 产瓜效率：单位时间内输出西瓜物品的数量（单位：西瓜/h），反映农场的总产出效率，也称为「总效率」

公式中的两个相乘的因数分别反映了「刷怪塔（小黑塔）」与「作物农场（瓜田）」各自的指标。

简单考虑瓜机的运行过程可知，刷怪效率与搬瓜率是一对存在矛盾的变量：两者的共同影响因素是末影人的存活时间（lifetime）。在保持其他条件一致的情况下，刷怪效率与存活时间负相关，搬瓜率与存活时间正相关，有可能出现以下极端情况：
- 如果存活时间极短，则刷怪效率达到最高，但搬瓜率几乎为0，总效率也几乎为0
- 如果存活时间极长，则搬瓜率几乎达到100%，但刷怪效率几乎为0，总效率也几乎为0
- 存活时间取到某个中间值，刷怪效率与搬瓜率既不是最高也不是最低，但总效率达到最高

由此公式很容易想到，要想使总效率最高，不应该孤立地考虑增加刷怪效率或增加搬瓜率，而应该使两个参数之间达到平衡，使两者的乘积尽可能大。由于这两个变量互相矛盾，所以我们有必要用可靠的数学公式分别描述两个变量，从而准确地分析它们的乘积随各个原始参数变化的规律，最终确定结构设计参数。

## 刷怪效率的预测

由于我们现在想追求极限效率，又因为其他基本因素的影响，所以对刷怪效率的计算作了以下假设：
1. 以单人世界为评价标准环境，刷怪上限为70
2. 刷怪面积足够大，任意时间断面的存活末影人数量约等于刷怪上限
3. 采用拌线钩检测式处理，存活时间集中在某个确定值附近
4. 不考虑极大的刷怪面积导致的「存活末影人数量略高于刷怪上限」的部分

为方便数学描述，用单字母符号表示以下变量：
- 刷怪上限：$M = 70$（mobcap）
- 存活时间：$L$（lifetime），待定参数；单位可采用gt（游戏刻）或h（小时），$1\mathrm{h}=72000\mathrm{gt}$；在单维度情况下，包含死亡动画的20gt
- 刷怪效率：$S$（spawning），末影人生成的效率，单位为mob/gt或mob/h

下面给出刷怪效率的计算方法。

首先假想一个$M = 1$的简单情况，第2条的要求「任意时间断面的存活末影人数量约等于刷怪上限」此时体现为「任意时间断面都恰好有1只存活的末影人」。

粗略考虑一下过程：在某一个$t$时刻，第$(n-1)$只末影人被移除，第$n$只末影人生成；经过一个生命周期，在$(t+L)$时刻，第$n$只末影人被移除，第$(n+1)$只末影人生成，重复上一个周期的过程。此时，平均每经过$L$时间移除并生成1只末影人，刷怪效率为：
$$S_1 = \frac{1}{L}$$

将上述过程推广到$M$取任意值的情况。考虑将生物容量分割成$M$个抽象的单元，每个单元的容量为1，且每个单元均满足第2条的要求。由于各个单元保持满容量状态，末影人被移除时立即生成下一只末影人，所以各个单元互不干扰，总刷怪效率是$M$个单元刷怪效率$S_1$的线性叠加：
$$S = M\cdot S_1 = \frac{M}{L}$$

在使用该公式时，需要注意时间单位的对应。如果采用常用单位，则需要使用以下换算后的公式：
$$刷怪效率\mathrm{(mob/h)} = \frac{刷怪上限\mathrm{(mob)} \times 72000}{存活时间\mathrm{(gt)}}$$

## 搬瓜率的预测


